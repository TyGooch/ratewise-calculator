<style>
  /* #calculatorTitle {
  font-size: 4rem !important;
} */
  /* body {
  font-family: roboto, sans-serif;
} */

  .subheader {
    font-size: 1.8rem;
    line-height: 40px;
    font-weight: 300;
    color: #9d9a9a;
    max-width: 920px;
    margin: 0 auto;
    text-align: center;
    letter-spacing: 0.3px;
  }

  h1 {
    font-size: 3.5rem !important;
    margin-top: 4rem;
    margin-bottom: 25px;
    /* color: #2c3e50; */
    font-weight: 600;
    text-align: center;
    /* font-size: 47px; */
  }

  .bg-purple {
    background: #5c39c6;
  }

  @media only screen and (max-width: 540px) {
    h1 {
      font-size: 1.75rem !important;
    }

    .subheader {
      font-size: 18px;
    }

    /* {
    padding-bottom: 0 !important;
  } */

    .container {
      padding: 0 !important;
    }

    .row {
      margin-left: 0 !important;
      margin-right: 0 !important;
    }

    .card__face {
      max-width: 100vw;
    }

    .currency-input-container::before {
      top: 9px !important;
    }

    .results-container {
      /* border-bottom: 1px solid #ccc; */
      /* background: transparent !important; */
    }

    .homepage-privacy .row {
      border-top: 0px !important;
    }
  }

  @media only screen and (min-width: 540px) and (max-width: 768px) {
    .card__face {
      max-width: 100vw;
    }

    h1 {
      font-size: 2.2rem !important;
    }

    .subheader {
      font-size: 18px;
    }

    .currency-input-container::before {
      top: 11px !important;
    }
    .custom-box {
      margin-bottom: 0;
    }
  }
  @media only screen and (min-width: 769px) and (max-width: 1070px) {
    h1 {
      font-size: 3rem !important;
    }
  }

  .calculator-container {
    background-color: #5c39c6;
    /* background: linear-gradient(180deg, #7355ce 0%, #5c39c6 38%, #4f30aa 100%) !important; */
    border-radius: 14px;
  }

  .calculator-container label {
    /* display: flex; */
    color: #fff !important;
  }

  .calculator-container .error {
    color: #f96363 !important;
    margin-bottom: 0 !important;
    font-size: 14px;
    padding-left: 0;
  }

  #calculateButton {
    border: 2px solid #fff;
    background: 0 0;
    opacity: 1;
    transition: all 0.1s 0.2s;
  }

  #calculateButton:hover {
    background: #442997 !important;
    /* transform: none !important; */
  }

  #calculateButton,
  #getQuoteButton {
    width: 100% !important;
    box-shadow: none !important;
    text-decoration: none !important;
    color: #fff !important;
  }

  #backButton {
    cursor: pointer;
    color: #4a4f53;
  }
  #backButton:hover {
    text-decoration: underline;
  }
  #backButton::before {
    display: inline-block;
    content: "";
    background-image: url("data:image/svg+xml,<svg class='bi bi-chevron-left' width='1em' height='1em' viewBox='0 0 16 16' fill='currentColor' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z'/></svg>");
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
    width: 1rem;
    height: 1rem;
    color: #4a4f53;
    top: 2px;
    position: relative;
    margin-right: 5px;
  }

  .results-main {
    color: #886be7;
    font-size: 4rem !important;
    font-weight: 700 !important;
    margin-bottom: 0 !important;
  }

  #afford {
    font-weight: 700;
    color: #000;
  }

  .dollars {
    left: 12px !important;
    top: 13.5px;
  }

  .calculator-input {
    /* padding: 0px !important; */
    padding: 1rem !important;
    padding-left: 0.75rem;
    /* padding-left: 30px !important; */
    border: 0 !important;
    background: #fff;
  }

  .currency-input-container {
    display: flex;
    margin-bottom: 1rem;
  }

  .currency-input-container .calculator-input {
    padding-left: 2.25rem !important;
  }

  .currency-input-container::before {
    content: "£";
    width: 0;
    height: 0;
    position: relative;
    left: 1rem;
    top: 14.5px;
    /* transition: opacity 1s; */
    font-size: 1.5rem;
    color: #000;
  }

  .currency-input-container.empty::before {
    color: #a9a9a9;
  }

  .calculator-select {
    width: 100% !important;
    border-radius: 3px !important;
    font-size: 25px !important;
    padding: 1rem !important;
    height: 100%;
    outline: none !important;
    border-color: transparent !important;
    box-shadow: none !important;
  }

  .disclaimer {
    color: #4a4f53;
    margin-right: auto;
    margin-left: auto;

    font-size: 0.75rem;
  }

  .purple {
    color: #5c39c6 !important;
  }

  .scene {
    width: 100%;
    height: 493px;
    perspective: 800px;
    transition: all 1s;
  }

  .flip-card {
    width: 100%;
    /* height: 493px; */
    position: relative;
    transition: all 1s;
    transform-style: preserve-3d;
    transform-origin: center right;
  }

  .flip-card.is-flipped {
    /* transform: rotateY(180deg); */
    transform: translateX(-100%) rotateY(-180deg);
  }

  .flip-card.is-flipped #calculateButton {
    opacity: 0;
    visibility: hidden;
  }

  .flip-card.is-flipped .currency-input-container::before {
    opacity: 0;
  }

  .card__face {
    position: absolute;
    /* height: fit-content; */
    width: 100%;
    /* backface-visibility: hidden; */
    -webkit-perspective: 0;
    -webkit-backface-visibility: hidden;
    /* -webkit-transform: rotateY(0, 0, 0); */
    /* visibility: visible; */
    backface-visibility: hidden;
  }

  .card__face--front {
    background: #5c39c6;
  }

  .card__face--back {
    /* border-top: 1px solid #ccc; */

    /* border: 1px solid #aaaaaa; */
    background: #fff;
    transform: rotateY(180deg);
  }

  .result-subheader {
    font-size: 1.25rem;
    /* line-height: 40px; */
    font-weight: 300;
    color: #9d9a9a;

    /* margin: 0 auto; */
    text-align: center;
    letter-spacing: 0.3px;
  }
</style>

<div class="container" id="mortgage">
  <h1 id="calculatorTitle">A Wiser Mortgage Calculator</h1>
  <p class="subheader">Find out how much you could borrow.</p>
  <div class="row justify-content-center mt-5">
    <div class="col-12 col-sm-12 col-md-8 col-lg-6 col-xl-6 col-xxl-6 scene">
      <div class="flip-card">
        <div class="card__face card__face--front calculator-container p-5" data-calculation="mortgage">
          <label class="label-text ml-0">Annual Pre-Tax Income<span class="error" id="errorincome"></span></label>
          <div class="currency-input-container empty">
            <input class="calculator-input" type="number" name="income" id="income" placeholder="0" required min="1" />
          </div>

          <label class="label-text ml-0">
            Other Income (bonus, commission, overtime)<span class="error" id="errorotherIncome"></span
          ></label>
          <div class="currency-input-container empty">
            <input class="calculator-input "" type="number" name="otherIncome" id="otherIncome" placeholder="0" min="0"
            />
          </div>

          <label class="label-text ml-0">Deposit Amount<span class="error" id="errordeposit"></span></label>
          <div class="currency-input-container empty">
            <input class="calculator-input"" type="number" name="deposit" id="deposit" placeholder="0" required
            min="1"/>
          </div>

          <button type="button" class="app-btn mt-4" id="calculateButton">Calculate</button>
        </div>

        <div class="card__face card__face--back results-container p-0 p-md-5 text-center">
          <p class="mb-0 result-subheader">You could borrow up to</p>
          <p class="results-main purple result-subheader mb-0" id="borrow"></p>
          <p class="mb-2 result-subheader">
            and buy a house worth
            <b id="afford"></b>.<span class="purple">*</span>
          </p>
          <p class="disclaimer purple">
            *Most residential mortgages require a minimum of 10% deposit.
          </p>
          <p class="disclaimer">
            This amount is an estimate based on what a typical bank may offer. All lending is subject to application and
            approval by the lender. The actual amount you can borrow will depend on your situation and lender criteria.
            Most residential mortgages require a minimum of 10% deposit. RateWise is an introducer, not a lender.
          </p>

          <button
            type="button"
            class="app-btn mb-4"
            id="getQuoteButton"
            data-url="https://ratewise.co.uk/mortgage/mortgage-type/"
          >
            Get My Quote
          </button>
          <a id="backButton">Back</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  const formatNumber = (x, n) => +x.toPrecision(n)

  const calculatePayment = (amount, interest, term) => {
    return ((amount * interest) / (1 - Math.pow(1 / (1 + interest), term * 12))).toFixed(2)
  }

  // window.onload = () => {
  document.querySelectorAll(".scene").forEach((el) => {
    el.style.height = document.querySelector(".calculator-container").offsetHeight + "px"
  })
  // }

  document.querySelectorAll("#calculateButton").forEach((el) => {
    el.onclick = (e) => {
      document.activeElement.blur()
      const calculation = e.target.parentElement.getAttribute("data-calculation")

      const container = document.querySelector("#" + calculation)

      if (calculation === "mortgage") {
        let income = parseInt(container.querySelector("#income").value)
        let otherIncome = parseInt(container.querySelector("#otherIncome").value)
        otherIncome = otherIncome ? otherIncome : 0
        let deposit = parseInt(container.querySelector("#deposit").value)

        // container.querySelector('.flip-card').click()

        if (!income || !deposit) {
          if (!income) {
            container.querySelector("#errorincome").textContent = "This field is required to be more than 0."
          }
          if (!deposit) {
            container.querySelector("#errordeposit").textContent = "This field is required to be more than 0."
          }
          return
        }

        let borrow = 4.52 * (income + otherIncome)
        borrow = Math.floor(borrow * 1) / 1
        borrow = formatNumber(borrow, 3)
        borrow = borrow.toLocaleString()

        let afford = 4.52 * (income + otherIncome)
        afford = parseInt(afford) + parseInt(deposit)
        afford = Math.floor(afford * 1) / 1
        afford = formatNumber(afford, 3)
        afford = afford.toLocaleString()

        container.querySelector("#borrow").textContent = "£" + borrow
        container.querySelector("#afford").textContent = "£" + afford

        container.querySelector("#errorincome").textContent = ""
        container.querySelector("#errordeposit").textContent = ""
      } else if (calculation === "business" || calculation === "car" || calculation === "personal") {
        let amount = parseInt(container.querySelector("#amount").value)
        let term = parseInt(container.querySelector("#term").value)
        let interest = parseFloat(container.querySelector("#interest").value) / 1200

        let monthlyPayment = calculatePayment(amount, interest, term)
        let totalAmount = (monthlyPayment * 12 * term).toFixed(2)

        if (!amount || !term || !interest) {
          if (!amount) {
            container.querySelector("#erroramount").textContent = "This field is required to be more than 0."
          }
          if (!term) {
            container.querySelector("#errorterm").textContent = "This field is required to be more than 0."
          }
          if (!interest) {
            container.querySelector("#errorinterest").textContent = "This field is required to be more than 0."
          }
          return
        }

        monthlyPayment = monthlyPayment.toLocaleString()
        totalAmount = totalAmount.toLocaleString()
        console.log("monthlyPayment", monthlyPayment)
        console.log("totalAmount", totalAmount)
        container.querySelector("#totalAmount").textContent = "£" + totalAmount
        container.querySelector("#monthlyPayment").textContent = "£" + monthlyPayment
        container.querySelector("#disclaimerAmount").textContent = "£" + amount.toLocaleString()
        container.querySelector("#disclaimerInterest").textContent = (interest * 1200).toFixed(2)
        container.querySelector("#disclaimerTerm").textContent = term
      }

      container.querySelector(".flip-card").classList.toggle("is-flipped")
      container.querySelector(".scene").style.height = container.querySelector(".results-container").offsetHeight + "px"
    }
  })

  document.querySelectorAll("#getQuoteButton").forEach((el) => {
    el.onclick = (e) => {
      let url = e.target.getAttribute("data-url")
      window.location.href = url
    }
  })

  document.querySelectorAll("#backButton").forEach((el) => {
    el.onclick = (e) => {
      const parent = e.target.parentElement.parentElement.parentElement
      parent.style.height = parent.querySelector(".calculator-container").offsetHeight + "px"
      parent.querySelector(".flip-card").classList.toggle("is-flipped")
    }
  })

  document.querySelectorAll(".calculator-container").forEach((el) => {
    el.oninput = (e) => {
      const parent = e.target.parentElement.parentElement
      if (e.target.value) {
        parent.querySelector(`#error${e.target.id}`).textContent = ""
        e.target.parentElement.classList.remove("empty")
      } else {
        if (e.target.required) {
          parent.querySelector(`#error${e.target.id}`).textContent = "This field is required to be more than 0."
        }
        e.target.parentElement.classList.add("empty")
      }
    }
  })
</script>
